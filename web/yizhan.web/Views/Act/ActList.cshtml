@using yizhan.web.Models
@model yizhan.web.ViewModels.ActListVm
@section BreadCrumbs{
    <li>首页</li>
    <li><a href="@Url.Action("ActList")">活动项目</a></li>
    @foreach (var item in Model.ParentList)
    {
        <li><a href="@Url.Action("ActList", new {fid = item.Id})">@item.Name</a></li>
    }
    @if (Model.Act != null)
    {
        <li><a href="@Url.Action("ActList", new {fid = Model.Act.Id})">@Model.Act.Name</a></li>
    }
}
<div class="rightinfo">
    <div class="tools">
        <ul class="toolbar">
            <li class="click"><a href="@Url.Action("ActEdit", new { parentFid = Model.Fid })"><span><img src="~/images/t01.png" /></span>添加</a></li>
        </ul>
    </div>

    <ul id="list" class="imglist">
        @foreach (var item in Model.Acts)
        {
            <li>
                <input class="Id" type="hidden" value="@item.Id"/>
                <span><img src="@item.PhotoUrl" style="width: 100%;height:100%" /></span>
                <h2>
                    @if (item.Depth < 3)
                    {
                        <a href="@Url.Action("ActList", new {fid = item.Id, pn = 1})">@item.Name</a>
                    }
                    else
                    {
                        <a href="@item.PhotoUrl">@item.Name</a>
                    }
                </h2>
                <p>
                    <a href="@Url.Action("ActEdit", new {fid = item.Id})">编辑</a>&nbsp;&nbsp;&nbsp;&nbsp;<a class="del" href="javascript:void(0)" onclick="return false">删除</a>
                </p>
            </li>
        }
    </ul>

    <div class="pagin">
        <div class="message">共<i class="blue">@Model.TotalCount</i>条记录
        </div>
        <div id="pager" class="paginList">

        </div>
    </div>
    <script type="text/javascript">
        $('#pager').pagination({
            totalData: @Model.TotalCount,
            showData: @Model.PageSize,
            current: @Model.Pn,
            coping: true,
            callback: function(api) {
                var data = {
                    page: api.getCurrent()
                };

                var url = '@Url.Action("ActList", new {fid = Model.Fid})' + "&pn=" + data.page;
                location.href = url;
            }
        });

        var lockobj = {};
        $('#list .del').click(function() {
            function submit() {
                tool.request({
                    url: 'ActEditPost',
                    data: {fid:$(this).find('id').val()} ,
                    dataType: 'json',
                    type: "POST",
                    success: function (d) {
                        if (d.Success) {
                            tool.tip('保存成功');
                        } else
                            tool.tip(d.Info);
                    },
                    error: function (e, d) {
                        tool.tip('操作失败');
                    }
                }, lockobj);
            }

            dialog({
                content: "确认要删除吗？",
                okValue: '确 定',
                ok: submit,
                quickClose: true,
                cancelValue: '取消',
                cancel: function () { }
            }).show();
        });
    </script>
@section HeaderScript{

    <script src="~/js/pagination/jquery.pagination.js"></script>
}
</div>